<?php

class SoireeDAO
{
    private $gestionConnexion;

    public function __construct()
    {
        $this->gestionConnexion = GestionConnexion::getConnexion();
    }

    public function chargerSoiree($idSoiree)
    {
        $sql = "SELECT idSoiree, nom, date, prixPlace, nombreDePlace, nombreDePlace - (SELECT SUM(nbPlacePrise) FROM reserver WHERE idSoiree=$idSoiree GROUP BY reserver.idSoiree) AS nbPlaceRestante FROM soiree WHERE idSoiree = $idSoiree";
        $res = $this->gestionConnexion->query($sql);
        $soiree = $res->fetch();
        $nombrePlaceRestante = is_null($soiree["nbPlaceRestante"]) ? ($soiree["nbPlaceRestante"] == 0 ? 0 : $soiree["nombreDePlace"]) : $soiree["nbPlaceRestante"];
        if ($nombrePlaceRestante < 0) {
            $nombrePlaceRestante = 0;
        }
        $objSoiree = new Soiree($idSoiree, $soiree["nom"], $soiree["date"], $soiree["nombreDePlace"], $soiree["prixPlace"], $nombrePlaceRestante);
        return $objSoiree;
    }

    public function recupererSoirees()
    {

    }
}